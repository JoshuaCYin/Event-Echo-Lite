<div id="calendarContainer">
    <div id="calendar"></div>
</div>

<script type="module">
import { api } from "../js/api.js";

const container = document.querySelector("#calendarContainer");

// Load calendar view
async function loadCalendarView() {
    try {
        const token = localStorage.getItem("token");
        const events = await api("/events/", "GET", null, token);
        
        const calendarEl = document.getElementById("calendar");
        
        const calendar = new window.FullCalendar.Calendar(calendarEl, {
            initialView: "dayGridMonth",
            headerToolbar: {
                left: 'prev,next today',
                center: 'title',
                right: 'dayGridMonth,timeGridWeek,timeGridDay'
            },
            buttonText: {
                today: 'Today',
                month: 'Month',
                week: 'Week',
                day: 'Day'
            },
            height: 'auto',
            aspectRatio: 1.8,
            events: events.map(e => ({
                title: e.title,
                start: e.start_time.replace(" ", "T"),
                end: e.end_time.replace(" ", "T"),
                extendedProps: {
                    location: e.location,
                    description: e.description
                }
            })),
        // const calendar = new window.FullCalendar.Calendar(calendarEl, {
        //     initialView: "dayGridMonth",
        //     headerToolbar: {
        //         left: 'prev,next today',
        //         center: 'title',
        //         right: 'dayGridMonth,timeGridWeek,listWeek'
        //     },
        //     buttonText: {
        //         today: 'Today',
        //         month: 'Month',
        //         week: 'Week',
        //         list: 'List'
        //     },
        //     height: 'auto',
        //     aspectRatio: 1.8,
        //     eventTextColor: '#ffffff',
        //     events: events.map(e => ({
        //         title: e.title,
        //         start: e.start_time.replace(" ", "T"),
        //         end: e.end_time.replace(" ", "T"),
        //         extendedProps: {
        //         location: e.location,
        //         description: e.description
        //         }
        //     })),
            eventClick: function(info) {
                alert(
                    'Event: ' + info.event.title + '\n' +
                    'Location: ' + (info.event.extendedProps.location || 'N/A') + '\n' +
                    'Start: ' + info.event.start.toLocaleString()
                );
            },
            eventMouseEnter: function(info) {
                info.el.style.opacity = '0.8';
            },
            eventMouseLeave: function(info) {
                info.el.style.opacity = '1';
            }
        });
        
        calendar.render();
        
    } catch (error) {
        console.error("Failed to load calendar:", error);
        container.innerHTML = '<div class="error-message">Failed to load calendar. Please try again.</div>';
    }
}

// Load calendar on page load
loadCalendarView();
</script>